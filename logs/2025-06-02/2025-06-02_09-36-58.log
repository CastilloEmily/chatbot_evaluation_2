2025-06-02 09:36:58,351 [INFO] [root] Logging configurado. Archivo de log: logs\2025-06-02\2025-06-02_09-36-58.log
2025-06-02 09:36:58,351 [INFO] [main] Inicio del programa principal
2025-06-02 09:36:58,353 [INFO] [EmailReporter] Inicializando EmailReporter y cargando variables de entorno...
2025-06-02 09:36:58,353 [INFO] [EmailReporter] Variables de entorno cargadas correctamente.
2025-06-02 09:36:58,353 [INFO] [main] Inicio del proceso en modo: combinations
2025-06-02 09:36:58,353 [INFO] [main] Generando combinaciones de parámetros desde: configs/settings_ranges.yaml
2025-06-02 09:36:58,354 [INFO] [main] Cargando combinaciones de parámetros desde archivo YAML: configs/settings_ranges.yaml
2025-06-02 09:36:58,359 [INFO] [main] Se generaron 64 combinaciones de parámetros.
2025-06-02 09:36:58,360 [INFO] [change_settings] Inicio actualización settings de Web App 'ChatRic' en RG 'openAI', en subscription 'b29c9dac-08df-4427-9ddb-d50fca7bc22f'
2025-06-02 09:36:58,363 [INFO] [azure.identity._credentials.environment] No environment configuration found.
2025-06-02 09:36:58,366 [INFO] [azure.identity._credentials.managed_identity] ManagedIdentityCredential will use IMDS
2025-06-02 09:36:58,367 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'http://169.254.169.254/metadata/identity/oauth2/token?api-version=REDACTED&resource=REDACTED'
Request method: 'GET'
Request headers:
    'User-Agent': 'azsdk-python-identity/1.23.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
No body was attached to the request
2025-06-02 09:37:00,157 [INFO] [azure.identity._credentials.chained] DefaultAzureCredential acquired a token from AzureCliCredential
2025-06-02 09:37:00,157 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'https://management.azure.com/subscriptions/b29c9dac-08df-4427-9ddb-d50fca7bc22f/resourceGroups/openAI/providers/Microsoft.Web/sites/ChatRic/config/appsettings/list?api-version=REDACTED'
Request method: 'POST'
Request headers:
    'Accept': 'application/json'
    'x-ms-client-request-id': '5d65c2b8-3f84-11f0-89be-24eb1694bf2d'
    'User-Agent': 'azsdk-python-azure-mgmt-web/8.0.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
    'Authorization': 'REDACTED'
No body was attached to the request
2025-06-02 09:37:01,164 [INFO] [azure.core.pipeline.policies.http_logging_policy] Response status: 200
Response headers:
    'Cache-Control': 'no-cache'
    'Pragma': 'no-cache'
    'Content-Length': '2708'
    'Content-Type': 'application/json'
    'Expires': '-1'
    'Strict-Transport-Security': 'REDACTED'
    'x-ms-request-id': '5be363aa-84cb-451a-a368-fabddb08f77e'
    'X-AspNet-Version': 'REDACTED'
    'X-Powered-By': 'REDACTED'
    'x-ms-operation-identifier': 'REDACTED'
    'x-ms-ratelimit-remaining-subscription-resource-requests': '11999'
    'x-ms-correlation-request-id': 'REDACTED'
    'x-ms-routing-request-id': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'X-Cache': 'REDACTED'
    'X-MSEdge-Ref': 'Ref A: 5EF7A893EF374AA49BF590FF5268713F Ref B: VIEEDGE1119 Ref C: 2025-06-02T07:37:00Z'
    'Date': 'Mon, 02 Jun 2025 07:37:00 GMT'
2025-06-02 09:37:01,164 [INFO] [change_settings] Configuración actual obtenida correctamente.
2025-06-02 09:37:01,165 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'https://management.azure.com/subscriptions/b29c9dac-08df-4427-9ddb-d50fca7bc22f/resourceGroups/openAI/providers/Microsoft.Web/sites/ChatRic/config/appsettings?api-version=REDACTED'
Request method: 'PUT'
Request headers:
    'Content-Type': 'application/json'
    'Content-Length': '2586'
    'Accept': 'application/json'
    'x-ms-client-request-id': '5f10d7fc-3f84-11f0-8042-24eb1694bf2d'
    'User-Agent': 'azsdk-python-azure-mgmt-web/8.0.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
    'Authorization': 'REDACTED'
A body is sent with the request
2025-06-02 09:37:02,290 [INFO] [azure.core.pipeline.policies.http_logging_policy] Response status: 200
Response headers:
    'Cache-Control': 'no-cache'
    'Pragma': 'no-cache'
    'Content-Length': '2708'
    'Content-Type': 'application/json'
    'Expires': '-1'
    'ETag': '"1DBD39105716DC0"'
    'Strict-Transport-Security': 'REDACTED'
    'x-ms-request-id': '9198a3c1-b378-4ca4-9159-2b278d4b1b70'
    'X-AspNet-Version': 'REDACTED'
    'X-Powered-By': 'REDACTED'
    'x-ms-operation-identifier': 'REDACTED'
    'x-ms-ratelimit-remaining-subscription-writes': '199'
    'x-ms-ratelimit-remaining-subscription-global-writes': 'REDACTED'
    'x-ms-correlation-request-id': 'REDACTED'
    'x-ms-routing-request-id': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'X-Cache': 'REDACTED'
    'X-MSEdge-Ref': 'Ref A: 9296EC04394945C0973BD8D81A1B9CB6 Ref B: VIEEDGE1119 Ref C: 2025-06-02T07:37:01Z'
    'Date': 'Mon, 02 Jun 2025 07:37:01 GMT'
2025-06-02 09:37:02,291 [INFO] [change_settings] Nueva configuración aplicada correctamente.
2025-06-02 09:37:02,292 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'https://management.azure.com/subscriptions/b29c9dac-08df-4427-9ddb-d50fca7bc22f/resourceGroups/openAI/providers/Microsoft.Web/sites/ChatRic/restart?api-version=REDACTED'
Request method: 'POST'
Request headers:
    'Accept': 'application/json'
    'x-ms-client-request-id': '5fbcc553-3f84-11f0-afda-24eb1694bf2d'
    'User-Agent': 'azsdk-python-azure-mgmt-web/8.0.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
    'Authorization': 'REDACTED'
No body was attached to the request
2025-06-02 09:37:03,031 [INFO] [azure.core.pipeline.policies.http_logging_policy] Response status: 200
Response headers:
    'Cache-Control': 'no-cache'
    'Pragma': 'no-cache'
    'Expires': '-1'
    'Strict-Transport-Security': 'REDACTED'
    'x-ms-request-id': '9c132836-7804-4818-ba20-29ea33cf8081'
    'X-AspNet-Version': 'REDACTED'
    'X-Powered-By': 'REDACTED'
    'x-ms-operation-identifier': 'REDACTED'
    'x-ms-ratelimit-remaining-subscription-writes': '199'
    'x-ms-ratelimit-remaining-subscription-global-writes': 'REDACTED'
    'x-ms-correlation-request-id': 'REDACTED'
    'x-ms-routing-request-id': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'X-Cache': 'REDACTED'
    'X-MSEdge-Ref': 'Ref A: 75AD8406A68543DA91F64D3EBD438679 Ref B: VIEEDGE1119 Ref C: 2025-06-02T07:37:02Z'
    'Date': 'Mon, 02 Jun 2025 07:37:02 GMT'
    'Content-Length': '0'
2025-06-02 09:37:03,032 [INFO] [change_settings] Solicitud de reinicio enviada.
2025-06-02 09:37:03,032 [INFO] [change_settings] Esperando a que la Web App esté en estado 'Running' (máximo 10 intentos)...
2025-06-02 09:37:08,034 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'https://management.azure.com/subscriptions/b29c9dac-08df-4427-9ddb-d50fca7bc22f/resourceGroups/openAI/providers/Microsoft.Web/sites/ChatRic?api-version=REDACTED'
Request method: 'GET'
Request headers:
    'Accept': 'application/json'
    'x-ms-client-request-id': '6328dd11-3f84-11f0-b1db-24eb1694bf2d'
    'User-Agent': 'azsdk-python-azure-mgmt-web/8.0.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
    'Authorization': 'REDACTED'
No body was attached to the request
2025-06-02 09:37:08,786 [INFO] [azure.core.pipeline.policies.http_logging_policy] Response status: 200
Response headers:
    'Cache-Control': 'no-cache'
    'Pragma': 'no-cache'
    'Content-Length': '8657'
    'Content-Type': 'application/json'
    'Expires': '-1'
    'ETag': '"1DBD3912127BF95"'
    'Strict-Transport-Security': 'REDACTED'
    'x-ms-request-id': '823e5859-3328-46e2-89dd-96ab990aad91'
    'X-AspNet-Version': 'REDACTED'
    'X-Powered-By': 'REDACTED'
    'x-ms-ratelimit-remaining-subscription-reads': '249'
    'x-ms-ratelimit-remaining-subscription-global-reads': 'REDACTED'
    'x-ms-correlation-request-id': 'REDACTED'
    'x-ms-routing-request-id': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'X-Cache': 'REDACTED'
    'X-MSEdge-Ref': 'Ref A: 7273488AB64F4A25B23BC2F507C9DAFF Ref B: VIEEDGE1119 Ref C: 2025-06-02T07:37:07Z'
    'Date': 'Mon, 02 Jun 2025 07:37:07 GMT'
2025-06-02 09:37:08,790 [INFO] [change_settings] La Web App está en estado 'Running'.
2025-06-02 09:37:08,790 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'https://management.azure.com/subscriptions/b29c9dac-08df-4427-9ddb-d50fca7bc22f/resourceGroups/openAI/providers/Microsoft.Web/sites/ChatRic/config/appsettings/list?api-version=REDACTED'
Request method: 'POST'
Request headers:
    'Accept': 'application/json'
    'x-ms-client-request-id': '639c504b-3f84-11f0-aa23-24eb1694bf2d'
    'User-Agent': 'azsdk-python-azure-mgmt-web/8.0.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
    'Authorization': 'REDACTED'
No body was attached to the request
2025-06-02 09:37:09,664 [INFO] [azure.core.pipeline.policies.http_logging_policy] Response status: 200
Response headers:
    'Cache-Control': 'no-cache'
    'Pragma': 'no-cache'
    'Content-Length': '2708'
    'Content-Type': 'application/json'
    'Expires': '-1'
    'Strict-Transport-Security': 'REDACTED'
    'x-ms-request-id': '9361ae3d-134c-4fc6-9c53-f8bfbb6eca93'
    'X-AspNet-Version': 'REDACTED'
    'X-Powered-By': 'REDACTED'
    'x-ms-operation-identifier': 'REDACTED'
    'x-ms-ratelimit-remaining-subscription-resource-requests': '11999'
    'x-ms-correlation-request-id': 'REDACTED'
    'x-ms-routing-request-id': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'X-Cache': 'REDACTED'
    'X-MSEdge-Ref': 'Ref A: 70382854079E4F2FBFEE2D60AFA1A688 Ref B: VIEEDGE1119 Ref C: 2025-06-02T07:37:08Z'
    'Date': 'Mon, 02 Jun 2025 07:37:08 GMT'
2025-06-02 09:37:10,057 [INFO] [loader] Latencia: 0.392 s
2025-06-02 09:37:10,057 [ERROR] [loader] Error 401: No autorizado.
2025-06-02 09:37:10,058 [ERROR] [loader] Error inesperado al enviar la pregunta
Traceback (most recent call last):
  File "C:\Users\CASTILLOEMILYGABRIEL\OneDrive - TK Elevator\Documentos\chatbot_evaluation\utils\loader.py", line 72, in send_question_to_target
    raise PermissionError("Error 401: No autorizado.")
PermissionError: Error 401: No autorizado.
2025-06-02 09:37:10,058 [INFO] [EmailReporter] Iniciando envío de reporte por correo.
2025-06-02 09:37:12,080 [INFO] [EmailReporter] ✅ Correo enviado con éxito.
2025-06-02 09:37:12,080 [ERROR] [main] Error en la ejecución principal: Error 401: No autorizado.
Traceback (most recent call last):
  File "C:\Users\CASTILLOEMILYGABRIEL\OneDrive - TK Elevator\Documentos\chatbot_evaluation\app\main.py", line 297, in main
    result = evaluate_combination(combination)
  File "C:\Users\CASTILLOEMILYGABRIEL\OneDrive - TK Elevator\Documentos\chatbot_evaluation\app\main.py", line 144, in evaluate_combination
    config_score = evaluate_label(label, questions, config)
  File "C:\Users\CASTILLOEMILYGABRIEL\OneDrive - TK Elevator\Documentos\chatbot_evaluation\app\main.py", line 166, in evaluate_label
    label_score = evaluate_question(question, config, label)
  File "C:\Users\CASTILLOEMILYGABRIEL\OneDrive - TK Elevator\Documentos\chatbot_evaluation\app\main.py", line 190, in evaluate_question
    response = send_question_to_target(query)
  File "C:\Users\CASTILLOEMILYGABRIEL\OneDrive - TK Elevator\Documentos\chatbot_evaluation\utils\loader.py", line 112, in send_question_to_target
    raise e  # propaga el error a .main
    ^^^^^^^
  File "C:\Users\CASTILLOEMILYGABRIEL\OneDrive - TK Elevator\Documentos\chatbot_evaluation\utils\loader.py", line 72, in send_question_to_target
    raise PermissionError("Error 401: No autorizado.")
PermissionError: Error 401: No autorizado.
