2025-05-30 11:27:15,185 [INFO] [root] Logging configurado. Archivo de log: logs\2025-05-30\2025-05-30_11-27-15.log
2025-05-30 11:27:15,186 [INFO] [main] Inicio del programa principal
2025-05-30 11:27:15,186 [INFO] [main] Inicio del proceso de evaluación del chatbot.
2025-05-30 11:27:15,186 [INFO] [main] Generando combinaciones de parámetros desde: configs/settings_ranges.yaml
2025-05-30 11:27:15,187 [INFO] [main] Cargando combinaciones de parámetros desde archivo YAML: configs/settings_ranges.yaml
2025-05-30 11:27:15,187 [INFO] [main] Se generaron 3 combinaciones de parámetros.
2025-05-30 11:27:15,193 [INFO] [change_settings] Inicio actualización settings de Web App 'ChatRic' en RG 'openAI', en subscription 'b29c9dac-08df-4427-9ddb-d50fca7bc22f'
2025-05-30 11:27:15,193 [INFO] [azure.identity._credentials.environment] No environment configuration found.
2025-05-30 11:27:15,195 [INFO] [azure.identity._credentials.managed_identity] ManagedIdentityCredential will use IMDS
2025-05-30 11:27:15,195 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'http://169.254.169.254/metadata/identity/oauth2/token?api-version=REDACTED&resource=REDACTED'
Request method: 'GET'
Request headers:
    'User-Agent': 'azsdk-python-identity/1.23.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
No body was attached to the request
2025-05-30 11:27:16,983 [INFO] [azure.identity._credentials.chained] DefaultAzureCredential acquired a token from AzureCliCredential
2025-05-30 11:27:16,983 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'https://management.azure.com/subscriptions/b29c9dac-08df-4427-9ddb-d50fca7bc22f/resourceGroups/openAI/providers/Microsoft.Web/sites/ChatRic/config/appsettings/list?api-version=REDACTED'
Request method: 'POST'
Request headers:
    'Accept': 'application/json'
    'x-ms-client-request-id': '46187458-3d38-11f0-8f95-24eb1694bf2d'
    'User-Agent': 'azsdk-python-azure-mgmt-web/8.0.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
    'Authorization': 'REDACTED'
No body was attached to the request
2025-05-30 11:27:17,675 [INFO] [azure.core.pipeline.policies.http_logging_policy] Response status: 200
Response headers:
    'Cache-Control': 'no-cache'
    'Pragma': 'no-cache'
    'Content-Length': '2717'
    'Content-Type': 'application/json'
    'Expires': '-1'
    'Strict-Transport-Security': 'REDACTED'
    'x-ms-request-id': '8d819e76-e47a-4cb0-a1cd-3bb1f13372af'
    'X-AspNet-Version': 'REDACTED'
    'X-Powered-By': 'REDACTED'
    'x-ms-operation-identifier': 'REDACTED'
    'x-ms-ratelimit-remaining-subscription-resource-requests': '11996'
    'x-ms-correlation-request-id': 'REDACTED'
    'x-ms-routing-request-id': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'X-Cache': 'REDACTED'
    'X-MSEdge-Ref': 'Ref A: B176DACD06C844F88DCFF8E10B9CCF26 Ref B: MAD201130411054 Ref C: 2025-05-30T09:27:17Z'
    'Date': 'Fri, 30 May 2025 09:27:17 GMT'
2025-05-30 11:27:17,676 [INFO] [change_settings] Configuración actual obtenida correctamente.
2025-05-30 11:27:17,677 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'https://management.azure.com/subscriptions/b29c9dac-08df-4427-9ddb-d50fca7bc22f/resourceGroups/openAI/providers/Microsoft.Web/sites/ChatRic/config/appsettings?api-version=REDACTED'
Request method: 'PUT'
Request headers:
    'Content-Type': 'application/json'
    'Content-Length': '2597'
    'Accept': 'application/json'
    'x-ms-client-request-id': '47932787-3d38-11f0-b957-24eb1694bf2d'
    'User-Agent': 'azsdk-python-azure-mgmt-web/8.0.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
    'Authorization': 'REDACTED'
A body is sent with the request
2025-05-30 11:27:19,191 [INFO] [azure.core.pipeline.policies.http_logging_policy] Response status: 200
Response headers:
    'Cache-Control': 'no-cache'
    'Pragma': 'no-cache'
    'Content-Length': '2717'
    'Content-Type': 'application/json'
    'Expires': '-1'
    'ETag': '"1DBD143D8549F00"'
    'Strict-Transport-Security': 'REDACTED'
    'x-ms-request-id': '58f2ac91-9861-4c23-890c-66acd8871a0f'
    'X-AspNet-Version': 'REDACTED'
    'X-Powered-By': 'REDACTED'
    'x-ms-operation-identifier': 'REDACTED'
    'x-ms-ratelimit-remaining-subscription-writes': '199'
    'x-ms-ratelimit-remaining-subscription-global-writes': 'REDACTED'
    'x-ms-correlation-request-id': 'REDACTED'
    'x-ms-routing-request-id': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'X-Cache': 'REDACTED'
    'X-MSEdge-Ref': 'Ref A: FC0D10262A9C4FE1B4DA1021F5C7195B Ref B: MAD201130411054 Ref C: 2025-05-30T09:27:17Z'
    'Date': 'Fri, 30 May 2025 09:27:19 GMT'
2025-05-30 11:27:19,192 [INFO] [change_settings] Nueva configuración aplicada correctamente.
2025-05-30 11:27:19,194 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'https://management.azure.com/subscriptions/b29c9dac-08df-4427-9ddb-d50fca7bc22f/resourceGroups/openAI/providers/Microsoft.Web/sites/ChatRic/restart?api-version=REDACTED'
Request method: 'POST'
Request headers:
    'Accept': 'application/json'
    'x-ms-client-request-id': '487a960b-3d38-11f0-b929-24eb1694bf2d'
    'User-Agent': 'azsdk-python-azure-mgmt-web/8.0.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
    'Authorization': 'REDACTED'
No body was attached to the request
2025-05-30 11:27:20,008 [INFO] [azure.core.pipeline.policies.http_logging_policy] Response status: 200
Response headers:
    'Cache-Control': 'no-cache'
    'Pragma': 'no-cache'
    'Expires': '-1'
    'Strict-Transport-Security': 'REDACTED'
    'x-ms-request-id': '2a14e1cb-8168-46bc-88f6-010c007bc5d7'
    'X-AspNet-Version': 'REDACTED'
    'X-Powered-By': 'REDACTED'
    'x-ms-operation-identifier': 'REDACTED'
    'x-ms-ratelimit-remaining-subscription-writes': '199'
    'x-ms-ratelimit-remaining-subscription-global-writes': 'REDACTED'
    'x-ms-correlation-request-id': 'REDACTED'
    'x-ms-routing-request-id': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'X-Cache': 'REDACTED'
    'X-MSEdge-Ref': 'Ref A: 0AC3367F7F2546A9AB8BD3E8CE749EE4 Ref B: MAD201130411054 Ref C: 2025-05-30T09:27:19Z'
    'Date': 'Fri, 30 May 2025 09:27:19 GMT'
    'Content-Length': '0'
2025-05-30 11:27:20,009 [INFO] [change_settings] Solicitud de reinicio enviada.
2025-05-30 11:27:20,009 [INFO] [change_settings] Esperando a que la Web App esté en estado 'Running' (máximo 10 intentos)...
2025-05-30 11:27:25,011 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'https://management.azure.com/subscriptions/b29c9dac-08df-4427-9ddb-d50fca7bc22f/resourceGroups/openAI/providers/Microsoft.Web/sites/ChatRic?api-version=REDACTED'
Request method: 'GET'
Request headers:
    'Accept': 'application/json'
    'x-ms-client-request-id': '4bf238db-3d38-11f0-817f-24eb1694bf2d'
    'User-Agent': 'azsdk-python-azure-mgmt-web/8.0.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
    'Authorization': 'REDACTED'
No body was attached to the request
2025-05-30 11:27:25,355 [INFO] [azure.core.pipeline.policies.http_logging_policy] Response status: 200
Response headers:
    'Cache-Control': 'no-cache'
    'Pragma': 'no-cache'
    'Content-Length': '8657'
    'Content-Type': 'application/json'
    'Expires': '-1'
    'ETag': '"1DBD1450A1623D5"'
    'Strict-Transport-Security': 'REDACTED'
    'x-ms-request-id': '9feed333-909c-4ebb-9bf5-e1b5ec91e9e5'
    'X-AspNet-Version': 'REDACTED'
    'X-Powered-By': 'REDACTED'
    'x-ms-ratelimit-remaining-subscription-reads': '249'
    'x-ms-ratelimit-remaining-subscription-global-reads': 'REDACTED'
    'x-ms-correlation-request-id': 'REDACTED'
    'x-ms-routing-request-id': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'X-Cache': 'REDACTED'
    'X-MSEdge-Ref': 'Ref A: 098620F5ADFF4B369558B9EEA95397AC Ref B: MAD201130411054 Ref C: 2025-05-30T09:27:25Z'
    'Date': 'Fri, 30 May 2025 09:27:25 GMT'
2025-05-30 11:27:25,360 [INFO] [change_settings] La Web App está en estado 'Running'.
2025-05-30 11:27:25,362 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'https://management.azure.com/subscriptions/b29c9dac-08df-4427-9ddb-d50fca7bc22f/resourceGroups/openAI/providers/Microsoft.Web/sites/ChatRic/config/appsettings/list?api-version=REDACTED'
Request method: 'POST'
Request headers:
    'Accept': 'application/json'
    'x-ms-client-request-id': '4c27c524-3d38-11f0-890e-24eb1694bf2d'
    'User-Agent': 'azsdk-python-azure-mgmt-web/8.0.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
    'Authorization': 'REDACTED'
No body was attached to the request
2025-05-30 11:27:26,636 [INFO] [azure.core.pipeline.policies.http_logging_policy] Response status: 200
Response headers:
    'Cache-Control': 'no-cache'
    'Pragma': 'no-cache'
    'Content-Length': '2717'
    'Content-Type': 'application/json'
    'Expires': '-1'
    'Strict-Transport-Security': 'REDACTED'
    'x-ms-request-id': '2fe4930f-a1c9-43c7-97f4-d253742c525c'
    'X-AspNet-Version': 'REDACTED'
    'X-Powered-By': 'REDACTED'
    'x-ms-operation-identifier': 'REDACTED'
    'x-ms-ratelimit-remaining-subscription-resource-requests': '11997'
    'x-ms-correlation-request-id': 'REDACTED'
    'x-ms-routing-request-id': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'X-Cache': 'REDACTED'
    'X-MSEdge-Ref': 'Ref A: 73C991BE3471405F943E8604883B0E09 Ref B: MAD201130411054 Ref C: 2025-05-30T09:27:25Z'
    'Date': 'Fri, 30 May 2025 09:27:26 GMT'
2025-05-30 11:27:31,575 [INFO] [loader] Latencia: 3.292 s
2025-05-30 11:27:31,577 [INFO] [evaluator] [cl1] Creando QAEvaluator con model_config...
2025-05-30 11:27:31,587 [INFO] [evaluator] [cl1] QAEvaluator creado correctamente. Iniciando evaluación...
2025-05-30 11:27:32,824 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 11:27:34,036 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 11:27:34,090 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 11:27:34,443 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 11:27:35,674 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 11:27:35,678 [INFO] [evaluator] [cl1] Evaluación completada correctamente.
2025-05-30 11:27:35,678 [INFO] [main] [INFO] Cargando pesos de métricas desde: configs/metric_weights.yaml
2025-05-30 11:27:35,681 [INFO] [main] Pregunta cl1 evaluada: 4.6 para la etiqueta 'close_question'
2025-05-30 11:27:41,781 [INFO] [loader] Latencia: 2.287 s
2025-05-30 11:27:41,784 [INFO] [evaluator] [te2] Creando QAEvaluator con model_config...
2025-05-30 11:27:41,793 [INFO] [evaluator] [te2] QAEvaluator creado correctamente. Iniciando evaluación...
2025-05-30 11:27:42,962 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 11:27:43,885 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 11:27:43,995 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 11:27:44,062 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 11:27:44,734 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 11:27:44,737 [INFO] [evaluator] [te2] Evaluación completada correctamente.
2025-05-30 11:27:44,738 [INFO] [main] Pregunta te2 evaluada: 3.0 para la etiqueta 'technical_precision'
2025-05-30 11:27:49,051 [INFO] [loader] Latencia: 2.236 s
2025-05-30 11:27:49,052 [INFO] [evaluator] [am3] Creando QAEvaluator con model_config...
2025-05-30 11:27:49,062 [INFO] [evaluator] [am3] QAEvaluator creado correctamente. Iniciando evaluación...
2025-05-30 11:27:49,997 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 11:27:51,066 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 11:27:51,436 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 11:27:51,639 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 11:27:51,859 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 11:27:51,862 [INFO] [evaluator] [am3] Evaluación completada correctamente.
2025-05-30 11:27:51,862 [INFO] [main] Pregunta am3 evaluada: 3.2 para la etiqueta 'ambiguous_or_error_handling'
2025-05-30 11:27:58,863 [INFO] [loader] Latencia: 2.480 s
2025-05-30 11:27:58,865 [INFO] [evaluator] [co4] Creando QAEvaluator con model_config...
2025-05-30 11:27:58,874 [INFO] [evaluator] [co4] QAEvaluator creado correctamente. Iniciando evaluación...
2025-05-30 11:27:59,908 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 11:28:01,174 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 11:28:01,381 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 11:28:01,451 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 11:28:02,372 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 11:28:02,374 [INFO] [evaluator] [co4] Evaluación completada correctamente.
2025-05-30 11:28:02,375 [INFO] [main] Pregunta co4 evaluada: 3.4 para la etiqueta 'comparison_standards'
2025-05-30 11:28:02,377 [ERROR] [main] Error en la ejecución principal: 'id'
Traceback (most recent call last):
  File "C:\Users\CASTILLOEMILYGABRIEL\OneDrive - TK Elevator\Documentos\chatbot_evaluation\app\main.py", line 280, in main
    combinations_pending = [c for c in combinations_pending if c["id"] != count]
                                                               ~^^^^^^
KeyError: 'id'
