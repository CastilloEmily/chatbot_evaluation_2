2025-05-30 08:45:35,066 [INFO] [root] Logging configurado. Archivo de log: logs\2025-05-30\2025-05-30_08-45-35.log
2025-05-30 08:45:35,067 [INFO] [main] Inicio del programa principal
2025-05-30 08:45:35,067 [INFO] [main] Inicio del proceso de evaluación del chatbot.
2025-05-30 08:45:35,068 [INFO] [main] Cargando combinaciones pendientes desde archivo: data/combinations\combinations_pending.json
2025-05-30 08:45:35,082 [INFO] [change_settings] Inicio actualización settings de Web App 'ChatRic' en RG 'openAI', en subscription 'b29c9dac-08df-4427-9ddb-d50fca7bc22f'
2025-05-30 08:45:35,082 [INFO] [azure.identity._credentials.environment] No environment configuration found.
2025-05-30 08:45:35,084 [INFO] [azure.identity._credentials.managed_identity] ManagedIdentityCredential will use IMDS
2025-05-30 08:45:35,085 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'http://169.254.169.254/metadata/identity/oauth2/token?api-version=REDACTED&resource=REDACTED'
Request method: 'GET'
Request headers:
    'User-Agent': 'azsdk-python-identity/1.23.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
No body was attached to the request
2025-05-30 08:45:36,992 [INFO] [azure.identity._credentials.chained] DefaultAzureCredential acquired a token from AzureCliCredential
2025-05-30 08:45:36,992 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'https://management.azure.com/subscriptions/b29c9dac-08df-4427-9ddb-d50fca7bc22f/resourceGroups/openAI/providers/Microsoft.Web/sites/ChatRic/config/appsettings/list?api-version=REDACTED'
Request method: 'POST'
Request headers:
    'Accept': 'application/json'
    'x-ms-client-request-id': 'b0612312-3d21-11f0-a352-24eb1694bf2d'
    'User-Agent': 'azsdk-python-azure-mgmt-web/8.0.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
    'Authorization': 'REDACTED'
No body was attached to the request
2025-05-30 08:45:38,131 [INFO] [azure.core.pipeline.policies.http_logging_policy] Response status: 200
Response headers:
    'Cache-Control': 'no-cache'
    'Pragma': 'no-cache'
    'Content-Length': '2708'
    'Content-Type': 'application/json'
    'Expires': '-1'
    'Strict-Transport-Security': 'REDACTED'
    'x-ms-request-id': '9af152ce-32d9-45f6-b48e-61630b1340e1'
    'X-AspNet-Version': 'REDACTED'
    'X-Powered-By': 'REDACTED'
    'x-ms-operation-identifier': 'REDACTED'
    'x-ms-ratelimit-remaining-subscription-resource-requests': '11996'
    'x-ms-correlation-request-id': 'REDACTED'
    'x-ms-routing-request-id': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'X-Cache': 'REDACTED'
    'X-MSEdge-Ref': 'Ref A: 31AFB4CB01F54B16972A6C2901754691 Ref B: MAD201130411034 Ref C: 2025-05-30T06:45:37Z'
    'Date': 'Fri, 30 May 2025 06:45:38 GMT'
2025-05-30 08:45:38,132 [INFO] [change_settings] Configuración actual obtenida correctamente.
2025-05-30 08:45:38,133 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'https://management.azure.com/subscriptions/b29c9dac-08df-4427-9ddb-d50fca7bc22f/resourceGroups/openAI/providers/Microsoft.Web/sites/ChatRic/config/appsettings?api-version=REDACTED'
Request method: 'PUT'
Request headers:
    'Content-Type': 'application/json'
    'Content-Length': '2586'
    'Accept': 'application/json'
    'x-ms-client-request-id': 'b23224fa-3d21-11f0-898e-24eb1694bf2d'
    'User-Agent': 'azsdk-python-azure-mgmt-web/8.0.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
    'Authorization': 'REDACTED'
A body is sent with the request
2025-05-30 08:45:39,980 [INFO] [azure.core.pipeline.policies.http_logging_policy] Response status: 200
Response headers:
    'Cache-Control': 'no-cache'
    'Pragma': 'no-cache'
    'Content-Length': '2708'
    'Content-Type': 'application/json'
    'Expires': '-1'
    'ETag': '"1DBD12D2BC39615"'
    'Strict-Transport-Security': 'REDACTED'
    'x-ms-request-id': 'b2781674-b0a5-4098-aae2-537ac696464c'
    'X-AspNet-Version': 'REDACTED'
    'X-Powered-By': 'REDACTED'
    'x-ms-operation-identifier': 'REDACTED'
    'x-ms-ratelimit-remaining-subscription-writes': '199'
    'x-ms-ratelimit-remaining-subscription-global-writes': 'REDACTED'
    'x-ms-correlation-request-id': 'REDACTED'
    'x-ms-routing-request-id': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'X-Cache': 'REDACTED'
    'X-MSEdge-Ref': 'Ref A: 29D2377423184420BEA42BB47EDF0DC9 Ref B: MAD201130411034 Ref C: 2025-05-30T06:45:38Z'
    'Date': 'Fri, 30 May 2025 06:45:40 GMT'
2025-05-30 08:45:39,981 [INFO] [change_settings] Nueva configuración aplicada correctamente.
2025-05-30 08:45:39,982 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'https://management.azure.com/subscriptions/b29c9dac-08df-4427-9ddb-d50fca7bc22f/resourceGroups/openAI/providers/Microsoft.Web/sites/ChatRic/restart?api-version=REDACTED'
Request method: 'POST'
Request headers:
    'Accept': 'application/json'
    'x-ms-client-request-id': 'b34c4e31-3d21-11f0-93f7-24eb1694bf2d'
    'User-Agent': 'azsdk-python-azure-mgmt-web/8.0.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
    'Authorization': 'REDACTED'
No body was attached to the request
2025-05-30 08:45:40,668 [INFO] [azure.core.pipeline.policies.http_logging_policy] Response status: 200
Response headers:
    'Cache-Control': 'no-cache'
    'Pragma': 'no-cache'
    'Expires': '-1'
    'Strict-Transport-Security': 'REDACTED'
    'x-ms-request-id': 'cc2445ae-73b8-45ea-a681-cb44f869009c'
    'X-AspNet-Version': 'REDACTED'
    'X-Powered-By': 'REDACTED'
    'x-ms-operation-identifier': 'REDACTED'
    'x-ms-ratelimit-remaining-subscription-writes': '199'
    'x-ms-ratelimit-remaining-subscription-global-writes': 'REDACTED'
    'x-ms-correlation-request-id': 'REDACTED'
    'x-ms-routing-request-id': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'X-Cache': 'REDACTED'
    'X-MSEdge-Ref': 'Ref A: F3812AD940D243D0961A113EFA126AF6 Ref B: MAD201130411034 Ref C: 2025-05-30T06:45:40Z'
    'Date': 'Fri, 30 May 2025 06:45:40 GMT'
    'Content-Length': '0'
2025-05-30 08:45:40,669 [INFO] [change_settings] Solicitud de reinicio enviada.
2025-05-30 08:45:40,669 [INFO] [change_settings] Esperando a que la Web App esté en estado 'Running' (máximo 10 intentos)...
2025-05-30 08:45:45,671 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'https://management.azure.com/subscriptions/b29c9dac-08df-4427-9ddb-d50fca7bc22f/resourceGroups/openAI/providers/Microsoft.Web/sites/ChatRic?api-version=REDACTED'
Request method: 'GET'
Request headers:
    'Accept': 'application/json'
    'x-ms-client-request-id': 'b6b05a6d-3d21-11f0-8784-24eb1694bf2d'
    'User-Agent': 'azsdk-python-azure-mgmt-web/8.0.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
    'Authorization': 'REDACTED'
No body was attached to the request
2025-05-30 08:45:46,482 [INFO] [azure.core.pipeline.policies.http_logging_policy] Response status: 200
Response headers:
    'Cache-Control': 'no-cache'
    'Pragma': 'no-cache'
    'Content-Length': '8652'
    'Content-Type': 'application/json'
    'Expires': '-1'
    'ETag': '"1DBD12E74CDB260"'
    'Strict-Transport-Security': 'REDACTED'
    'x-ms-request-id': 'b599a166-00d3-4a27-a69e-8cfb24f0dfb1'
    'X-AspNet-Version': 'REDACTED'
    'X-Powered-By': 'REDACTED'
    'x-ms-ratelimit-remaining-subscription-reads': '249'
    'x-ms-ratelimit-remaining-subscription-global-reads': 'REDACTED'
    'x-ms-correlation-request-id': 'REDACTED'
    'x-ms-routing-request-id': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'X-Cache': 'REDACTED'
    'X-MSEdge-Ref': 'Ref A: 460538CFB5E548CBAE9549E95E5B4206 Ref B: MAD201130411034 Ref C: 2025-05-30T06:45:45Z'
    'Date': 'Fri, 30 May 2025 06:45:46 GMT'
2025-05-30 08:45:46,490 [INFO] [change_settings] La Web App está en estado 'Running'.
2025-05-30 08:45:46,491 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'https://management.azure.com/subscriptions/b29c9dac-08df-4427-9ddb-d50fca7bc22f/resourceGroups/openAI/providers/Microsoft.Web/sites/ChatRic/config/appsettings/list?api-version=REDACTED'
Request method: 'POST'
Request headers:
    'Accept': 'application/json'
    'x-ms-client-request-id': 'b72d7cce-3d21-11f0-81d7-24eb1694bf2d'
    'User-Agent': 'azsdk-python-azure-mgmt-web/8.0.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
    'Authorization': 'REDACTED'
No body was attached to the request
2025-05-30 08:45:46,992 [INFO] [azure.core.pipeline.policies.http_logging_policy] Response status: 200
Response headers:
    'Cache-Control': 'no-cache'
    'Pragma': 'no-cache'
    'Content-Length': '2708'
    'Content-Type': 'application/json'
    'Expires': '-1'
    'Strict-Transport-Security': 'REDACTED'
    'x-ms-request-id': '76a000c5-1163-420c-bbf0-5dff0eccbe71'
    'X-AspNet-Version': 'REDACTED'
    'X-Powered-By': 'REDACTED'
    'x-ms-operation-identifier': 'REDACTED'
    'x-ms-ratelimit-remaining-subscription-resource-requests': '11999'
    'x-ms-correlation-request-id': 'REDACTED'
    'x-ms-routing-request-id': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'X-Cache': 'REDACTED'
    'X-MSEdge-Ref': 'Ref A: 399DAB81EF2E40D08D07AF864681B80B Ref B: MAD201130411034 Ref C: 2025-05-30T06:45:46Z'
    'Date': 'Fri, 30 May 2025 06:45:47 GMT'
2025-05-30 08:45:51,516 [INFO] [loader] Latencia: 2.950 s
2025-05-30 08:45:51,518 [INFO] [evaluator] [cl1] Creando QAEvaluator con model_config...
2025-05-30 08:45:51,566 [INFO] [evaluator] [cl1] QAEvaluator creado correctamente. Iniciando evaluación...
2025-05-30 08:45:52,910 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 08:45:54,396 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 08:45:54,834 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 08:45:54,834 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 08:45:54,873 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 08:45:54,875 [INFO] [evaluator] [cl1] Evaluación completada correctamente.
2025-05-30 08:45:54,875 [INFO] [main] [INFO] Cargando pesos de métricas desde: configs/metric_weights.yaml
2025-05-30 08:45:54,893 [INFO] [main] Pregunta cl1 evaluada: 3.6 para la etiqueta 'close_question'
2025-05-30 08:46:00,750 [INFO] [loader] Latencia: 1.877 s
2025-05-30 08:46:00,752 [INFO] [evaluator] [te2] Creando QAEvaluator con model_config...
2025-05-30 08:46:00,764 [INFO] [evaluator] [te2] QAEvaluator creado correctamente. Iniciando evaluación...
2025-05-30 08:46:01,745 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 08:46:02,767 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 08:46:03,261 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 08:46:03,587 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 08:46:04,060 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 08:46:04,063 [INFO] [evaluator] [te2] Evaluación completada correctamente.
2025-05-30 08:46:04,064 [INFO] [main] Pregunta te2 evaluada: 3.6 para la etiqueta 'technical_precision'
2025-05-30 08:46:08,675 [INFO] [loader] Latencia: 2.459 s
2025-05-30 08:46:08,676 [INFO] [evaluator] [am3] Creando QAEvaluator con model_config...
2025-05-30 08:46:08,685 [INFO] [evaluator] [am3] QAEvaluator creado correctamente. Iniciando evaluación...
2025-05-30 08:46:09,781 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 08:46:10,948 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 08:46:11,153 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 08:46:11,232 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 08:46:12,177 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 08:46:12,180 [INFO] [evaluator] [am3] Evaluación completada correctamente.
2025-05-30 08:46:12,181 [INFO] [main] Pregunta am3 evaluada: 3.2 para la etiqueta 'ambiguous_or_error_handling'
2025-05-30 08:46:18,287 [INFO] [loader] Latencia: 2.676 s
2025-05-30 08:46:18,291 [INFO] [evaluator] [co4] Creando QAEvaluator con model_config...
2025-05-30 08:46:18,302 [INFO] [evaluator] [co4] QAEvaluator creado correctamente. Iniciando evaluación...
2025-05-30 08:46:19,594 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 08:46:20,803 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 08:46:20,892 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 08:46:20,941 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 08:46:21,607 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-30 08:46:21,612 [INFO] [evaluator] [co4] Evaluación completada correctamente.
2025-05-30 08:46:21,613 [INFO] [main] Pregunta co4 evaluada: 3.2 para la etiqueta 'comparison_standards'
2025-05-30 08:46:21,615 [INFO] [main] Evaluación completada para la configuración: {'AZURE_OPENAI_SYSTEM_MESSAGE': 'Mensaje sistema 2', 'AZURE_OPENAI_TEMPERATURE': 0.0, 'AZURE_OPENAI_TOP_P': 0.0, 'AZURE_OPENAI_MAX_TOKENS': 10, 'AZURE_SEARCH_STRICTNESS': 0, 'AZURE_SEARCH_TOP_K': 0}, resultado: {'AZURE_OPENAI_SYSTEM_MESSAGE': 'Mensaje sistema 2', 'AZURE_OPENAI_TEMPERATURE': 0.0, 'AZURE_OPENAI_TOP_P': 0.0, 'AZURE_OPENAI_MAX_TOKENS': 10, 'AZURE_SEARCH_STRICTNESS': 0, 'AZURE_SEARCH_TOP_K': 0}
2025-05-30 08:46:21,615 [INFO] [EmailReporter] Inicializando EmailReporter y cargando variables de entorno...
2025-05-30 08:46:21,616 [INFO] [EmailReporter] Variables de entorno cargadas correctamente.
2025-05-30 08:46:21,616 [INFO] [EmailReporter] Iniciando envío de reporte por correo.
2025-05-30 08:46:21,616 [INFO] [EmailReporter] Cargando archivo JSON desde: results\2025-05-30_08-45-35\2025-05-30_08-45-35_by_combination.json
2025-05-30 08:46:21,640 [INFO] [EmailReporter] Archivo JSON cargado correctamente. Registros totales: 2
2025-05-30 08:46:21,640 [ERROR] [main] Error en la ejecución principal: string indices must be integers, not 'str'
Traceback (most recent call last):
  File "C:\Users\CASTILLOEMILYGABRIEL\OneDrive - TK Elevator\Documentos\chatbot_evaluation\app\main.py", line 301, in main
    reporter.send_report(output_path_by_combination, elapsed)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\CASTILLOEMILYGABRIEL\OneDrive - TK Elevator\Documentos\chatbot_evaluation\utils\create_report.py", line 76, in send_report
    sorted_data = sorted(data, key=lambda x: x['total_score'], reverse=True)
  File "C:\Users\CASTILLOEMILYGABRIEL\OneDrive - TK Elevator\Documentos\chatbot_evaluation\utils\create_report.py", line 76, in <lambda>
    sorted_data = sorted(data, key=lambda x: x['total_score'], reverse=True)
                                             ~^^^^^^^^^^^^^^^
TypeError: string indices must be integers, not 'str'
