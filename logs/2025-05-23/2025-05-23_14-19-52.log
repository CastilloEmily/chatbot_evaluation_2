2025-05-23 14:19:52,018 [INFO] [root] Logging configurado. Archivo de log: logs\2025-05-23\2025-05-23_14-19-52.log
2025-05-23 14:19:52,019 [INFO] [main] Inicio del programa principal
2025-05-23 14:19:52,019 [INFO] [main] Inicio del proceso de evaluación del chatbot.
2025-05-23 14:19:52,023 [INFO] [main] Aplicando configuración 1/3072: {'AZURE_OPENAI_SYSTEM_MESSAGE': 'Mensaje sistema 1', 'AZURE_OPENAI_TEMPERATURE': 0.0, 'AZURE_OPENAI_TOP_P': 0.0, 'AZURE_OPENAI_MAX_TOKENS': 10, 'AZURE_SEARCH_STRICTNESS': 0, 'AZURE_SEARCH_TOP_K': 0}
2025-05-23 14:19:52,023 [INFO] [change_settings] Inicio actualización settings de Web App 'ChatRic' en RG 'openAI', en subscription 'b29c9dac-08df-4427-9ddb-d50fca7bc22f'
2025-05-23 14:19:52,028 [INFO] [azure.identity._credentials.environment] No environment configuration found.
2025-05-23 14:19:52,032 [INFO] [azure.identity._credentials.managed_identity] ManagedIdentityCredential will use IMDS
2025-05-23 14:19:52,033 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'http://169.254.169.254/metadata/identity/oauth2/token?api-version=REDACTED&resource=REDACTED'
Request method: 'GET'
Request headers:
    'User-Agent': 'azsdk-python-identity/1.23.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
No body was attached to the request
2025-05-23 14:19:53,756 [INFO] [azure.identity._credentials.chained] DefaultAzureCredential acquired a token from AzureCliCredential
2025-05-23 14:19:53,757 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'https://management.azure.com/subscriptions/b29c9dac-08df-4427-9ddb-d50fca7bc22f/resourceGroups/openAI/providers/Microsoft.Web/sites/ChatRic/config/appsettings/list?api-version=REDACTED'
Request method: 'POST'
Request headers:
    'Accept': 'application/json'
    'x-ms-client-request-id': '3a5c272c-37d0-11f0-b7dc-24eb1694bf2d'
    'User-Agent': 'azsdk-python-azure-mgmt-web/8.0.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
    'Authorization': 'REDACTED'
No body was attached to the request
2025-05-23 14:19:55,526 [INFO] [azure.core.pipeline.policies.http_logging_policy] Response status: 200
Response headers:
    'Cache-Control': 'no-cache'
    'Pragma': 'no-cache'
    'Content-Length': '2708'
    'Content-Type': 'application/json'
    'Expires': '-1'
    'Strict-Transport-Security': 'REDACTED'
    'x-ms-request-id': 'ac9b1567-8247-4c98-a301-a31b2dc70cb0'
    'X-AspNet-Version': 'REDACTED'
    'X-Powered-By': 'REDACTED'
    'x-ms-operation-identifier': 'REDACTED'
    'x-ms-ratelimit-remaining-subscription-resource-requests': '11996'
    'x-ms-correlation-request-id': 'REDACTED'
    'x-ms-routing-request-id': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'X-Cache': 'REDACTED'
    'X-MSEdge-Ref': 'Ref A: 554506FC1E0444988F10AE1F8DF847EE Ref B: MAD201130411034 Ref C: 2025-05-23T12:19:53Z'
    'Date': 'Fri, 23 May 2025 12:19:55 GMT'
2025-05-23 14:19:55,527 [INFO] [change_settings] Configuración actual obtenida correctamente.
2025-05-23 14:19:55,528 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'https://management.azure.com/subscriptions/b29c9dac-08df-4427-9ddb-d50fca7bc22f/resourceGroups/openAI/providers/Microsoft.Web/sites/ChatRic/config/appsettings?api-version=REDACTED'
Request method: 'PUT'
Request headers:
    'Content-Type': 'application/json'
    'Content-Length': '2586'
    'Accept': 'application/json'
    'x-ms-client-request-id': '3c718dd8-37d0-11f0-9b64-24eb1694bf2d'
    'User-Agent': 'azsdk-python-azure-mgmt-web/8.0.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
    'Authorization': 'REDACTED'
A body is sent with the request
2025-05-23 14:19:57,408 [INFO] [azure.core.pipeline.policies.http_logging_policy] Response status: 200
Response headers:
    'Cache-Control': 'no-cache'
    'Pragma': 'no-cache'
    'Content-Length': '2708'
    'Content-Type': 'application/json'
    'Expires': '-1'
    'ETag': '"1DBCBDC3771A540"'
    'Strict-Transport-Security': 'REDACTED'
    'x-ms-request-id': '45a387f2-8877-469b-b08b-43e845c19ea4'
    'X-AspNet-Version': 'REDACTED'
    'X-Powered-By': 'REDACTED'
    'x-ms-operation-identifier': 'REDACTED'
    'x-ms-ratelimit-remaining-subscription-writes': '199'
    'x-ms-ratelimit-remaining-subscription-global-writes': 'REDACTED'
    'x-ms-correlation-request-id': 'REDACTED'
    'x-ms-routing-request-id': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'X-Cache': 'REDACTED'
    'X-MSEdge-Ref': 'Ref A: 0B54545E7F0A4550B69BA598703F00C7 Ref B: MAD201130411034 Ref C: 2025-05-23T12:19:55Z'
    'Date': 'Fri, 23 May 2025 12:19:57 GMT'
2025-05-23 14:19:57,409 [INFO] [change_settings] Nueva configuración aplicada correctamente.
2025-05-23 14:19:57,410 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'https://management.azure.com/subscriptions/b29c9dac-08df-4427-9ddb-d50fca7bc22f/resourceGroups/openAI/providers/Microsoft.Web/sites/ChatRic/restart?api-version=REDACTED'
Request method: 'POST'
Request headers:
    'Accept': 'application/json'
    'x-ms-client-request-id': '3d90b030-37d0-11f0-b28b-24eb1694bf2d'
    'User-Agent': 'azsdk-python-azure-mgmt-web/8.0.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
    'Authorization': 'REDACTED'
No body was attached to the request
2025-05-23 14:19:57,995 [INFO] [azure.core.pipeline.policies.http_logging_policy] Response status: 200
Response headers:
    'Cache-Control': 'no-cache'
    'Pragma': 'no-cache'
    'Expires': '-1'
    'Strict-Transport-Security': 'REDACTED'
    'x-ms-request-id': '0c66bc24-8628-4d0e-989a-bdee76c2d687'
    'X-AspNet-Version': 'REDACTED'
    'X-Powered-By': 'REDACTED'
    'x-ms-operation-identifier': 'REDACTED'
    'x-ms-ratelimit-remaining-subscription-writes': '199'
    'x-ms-ratelimit-remaining-subscription-global-writes': 'REDACTED'
    'x-ms-correlation-request-id': 'REDACTED'
    'x-ms-routing-request-id': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'X-Cache': 'REDACTED'
    'X-MSEdge-Ref': 'Ref A: 9CA4081B19794D0D9E507C359F67997A Ref B: MAD201130411034 Ref C: 2025-05-23T12:19:57Z'
    'Date': 'Fri, 23 May 2025 12:19:57 GMT'
    'Content-Length': '0'
2025-05-23 14:19:57,995 [INFO] [change_settings] Solicitud de reinicio enviada.
2025-05-23 14:19:57,995 [INFO] [change_settings] Esperando a que la Web App esté en estado 'Running' (máximo 10 intentos)...
2025-05-23 14:20:02,997 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'https://management.azure.com/subscriptions/b29c9dac-08df-4427-9ddb-d50fca7bc22f/resourceGroups/openAI/providers/Microsoft.Web/sites/ChatRic?api-version=REDACTED'
Request method: 'GET'
Request headers:
    'Accept': 'application/json'
    'x-ms-client-request-id': '40e53857-37d0-11f0-bfc2-24eb1694bf2d'
    'User-Agent': 'azsdk-python-azure-mgmt-web/8.0.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
    'Authorization': 'REDACTED'
No body was attached to the request
2025-05-23 14:20:05,144 [INFO] [azure.core.pipeline.policies.http_logging_policy] Response status: 200
Response headers:
    'Cache-Control': 'no-cache'
    'Pragma': 'no-cache'
    'Content-Length': '8657'
    'Content-Type': 'application/json'
    'Expires': '-1'
    'ETag': '"1DBCBDCFEC2870B"'
    'Strict-Transport-Security': 'REDACTED'
    'x-ms-request-id': '39aba375-30ca-456e-b032-a12994669c6b'
    'X-AspNet-Version': 'REDACTED'
    'X-Powered-By': 'REDACTED'
    'x-ms-ratelimit-remaining-subscription-reads': '249'
    'x-ms-ratelimit-remaining-subscription-global-reads': 'REDACTED'
    'x-ms-correlation-request-id': 'REDACTED'
    'x-ms-routing-request-id': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'X-Cache': 'REDACTED'
    'X-MSEdge-Ref': 'Ref A: 153D97269E024FCCAD34F5E4BE6568D7 Ref B: MAD201130411034 Ref C: 2025-05-23T12:20:02Z'
    'Date': 'Fri, 23 May 2025 12:20:04 GMT'
2025-05-23 14:20:05,146 [INFO] [change_settings] La Web App está en estado 'Running'.
2025-05-23 14:20:05,147 [INFO] [azure.core.pipeline.policies.http_logging_policy] Request URL: 'https://management.azure.com/subscriptions/b29c9dac-08df-4427-9ddb-d50fca7bc22f/resourceGroups/openAI/providers/Microsoft.Web/sites/ChatRic/config/appsettings/list?api-version=REDACTED'
Request method: 'POST'
Request headers:
    'Accept': 'application/json'
    'x-ms-client-request-id': '422d39b6-37d0-11f0-8c45-24eb1694bf2d'
    'User-Agent': 'azsdk-python-azure-mgmt-web/8.0.0 Python/3.13.3 (Windows-11-10.0.26100-SP0)'
    'Authorization': 'REDACTED'
No body was attached to the request
2025-05-23 14:20:06,589 [INFO] [azure.core.pipeline.policies.http_logging_policy] Response status: 200
Response headers:
    'Cache-Control': 'no-cache'
    'Pragma': 'no-cache'
    'Content-Length': '2708'
    'Content-Type': 'application/json'
    'Expires': '-1'
    'Strict-Transport-Security': 'REDACTED'
    'x-ms-request-id': 'a89cfeed-5780-48a7-9c6f-d4024194a48e'
    'X-AspNet-Version': 'REDACTED'
    'X-Powered-By': 'REDACTED'
    'x-ms-operation-identifier': 'REDACTED'
    'x-ms-ratelimit-remaining-subscription-resource-requests': '11996'
    'x-ms-correlation-request-id': 'REDACTED'
    'x-ms-routing-request-id': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'X-Cache': 'REDACTED'
    'X-MSEdge-Ref': 'Ref A: 74285DC62F41407A91862DA9672002A8 Ref B: MAD201130411034 Ref C: 2025-05-23T12:20:05Z'
    'Date': 'Fri, 23 May 2025 12:20:06 GMT'
2025-05-23 14:20:06,590 [INFO] [main] Evaluando configuración 1/3072: {'AZURE_OPENAI_SYSTEM_MESSAGE': 'Mensaje sistema 1', 'AZURE_OPENAI_TEMPERATURE': 0.0, 'AZURE_OPENAI_TOP_P': 0.0, 'AZURE_OPENAI_MAX_TOKENS': 10, 'AZURE_SEARCH_STRICTNESS': 0, 'AZURE_SEARCH_TOP_K': 0}
2025-05-23 14:20:06,591 [ERROR] [loader] Error de conexión con el servidor
Traceback (most recent call last):
  File "C:\Users\CASTILLOEMILYGABRIEL\OneDrive - TK Elevator\Documentos\chatbot_evaluation\utils\loader.py", line 40, in send_question_to_target
    response = requests.post(url, headers=headers, json=body, cookies=session_cookies, verify=False)
  File "C:\Users\CASTILLOEMILYGABRIEL\OneDrive - TK Elevator\Documentos\chatbot_evaluation\evaluation\Lib\site-packages\requests\api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
  File "C:\Users\CASTILLOEMILYGABRIEL\OneDrive - TK Elevator\Documentos\chatbot_evaluation\evaluation\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\CASTILLOEMILYGABRIEL\OneDrive - TK Elevator\Documentos\chatbot_evaluation\evaluation\Lib\site-packages\requests\sessions.py", line 575, in request
    prep = self.prepare_request(req)
  File "C:\Users\CASTILLOEMILYGABRIEL\OneDrive - TK Elevator\Documentos\chatbot_evaluation\evaluation\Lib\site-packages\requests\sessions.py", line 484, in prepare_request
    p.prepare(
    ~~~~~~~~~^
        method=request.method.upper(),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<10 lines>...
        hooks=merge_hooks(request.hooks, self.hooks),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\CASTILLOEMILYGABRIEL\OneDrive - TK Elevator\Documentos\chatbot_evaluation\evaluation\Lib\site-packages\requests\models.py", line 367, in prepare
    self.prepare_url(url, params)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "C:\Users\CASTILLOEMILYGABRIEL\OneDrive - TK Elevator\Documentos\chatbot_evaluation\evaluation\Lib\site-packages\requests\models.py", line 438, in prepare_url
    raise MissingSchema(
    ...<2 lines>...
    )
requests.exceptions.MissingSchema: Invalid URL 'cookies': No scheme supplied. Perhaps you meant https://cookies?
2025-05-23 14:20:06,593 [INFO] [evaluator] Creando QAEvaluator con model_config...
2025-05-23 14:20:06,603 [INFO] [evaluator] QAEvaluator creado correctamente. Iniciando evaluación...
2025-05-23 14:20:07,853 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-23 14:20:08,877 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-23 14:20:09,107 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-23 14:20:09,133 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-23 14:20:09,342 [INFO] [httpx] HTTP Request: POST https://ea-shared-ai-serviceplan-01-prod.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-05-23 14:20:09,347 [INFO] [evaluator] Evaluación completada para pregunta 'a'.
2025-05-23 14:20:09,348 [ERROR] [main] Error en la ejecución principal: too many values to unpack (expected 6)
Traceback (most recent call last):
  File "C:\Users\CASTILLOEMILYGABRIEL\OneDrive - TK Elevator\Documentos\chatbot_evaluation\app\main.py", line 165, in main
    for qid, label, question, expected, actual, context in send_question_to_target(questions_by_label, auth_mode):
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: too many values to unpack (expected 6)
